<%- contentFor('body') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>

<style>
  /* Cursor Interativo para os números */
  .stat-value.p-alta, .stat-value.p-media, .stat-value.p-baixa {
    cursor: pointer; text-decoration: underline; transition: text-shadow 0.3s ease;
  }
  .stat-value.p-alta:hover { text-shadow: 0 0 10px #ff0000; }
  .stat-value.p-media:hover { text-shadow: 0 0 10px #ffff00; }
  .stat-value.p-baixa:hover { text-shadow: 0 0 10px #00ff00; }
  
  /* Layout Principal */
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  .full-width-card {
    grid-column: 1 / -1;
  }

  /* Container dos Gráficos */
  .chart-wrapper {
    position: relative;
    height: 220px;
    width: 100%;
    margin-top: 15px;
  }

  /* Header do Card com Select */
  .card-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    border-bottom: 1px solid #333;
    padding-bottom: 5px;
  }

  /* Estilo do Select "Visualizar" */
  .view-selector {
    background: #000;
    color: #00ff00;
    border: 1px solid #00ff00;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    padding: 2px 5px;
    cursor: pointer;
  }
  .view-selector:focus { outline: none; box-shadow: 0 0 5px #00ff00; }

  /* --- GRID DE BUSCA CORRIGIDO E ALINHADO --- */
  .search-grid-layout {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr; /* 3 colunas iguais */
    gap: 15px;
    align-items: end; /* Alinha tudo na base */
  }

  .search-buttons-group {
    display: flex;
    gap: 10px;
    width: 100%;
  }

  /* Força botões a terem tamanhos iguais */
  .search-btn {
    flex: 1;         /* Ocupa espaço igual */
    width: 100%;     /* Garante largura total do container pai */
    height: 42px;    /* Altura fixa para alinhar com o input date */
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
  }

  /* Responsividade para Mobile */
  @media (max-width: 768px) {
    .search-grid-layout {
      grid-template-columns: 1fr; /* Uma coluna em telas pequenas */
    }
  }
</style>

<div class="container-lista">
  <div class="terminal-header">
    <div class="terminal-title">system@dashboard:~</div>
    <div class="terminal-controls">
      <div class="control-btn minimize"></div>
      <div class="control-btn maximize"></div>
      <div class="control-btn close"></div>
    </div>
  </div>

  <div class="terminal-body dashboard-container">
    <h1 class="glitch" data-text="[ Dashboard v3.0 ]">[ Dashboard v3.0 ]</h1>
    <p class="console-text" id="dashboard-status">C:\\> Inicializando_sistema_visual...</p>

    <div class="dashboard-grid">
      
      <div class="stat-card">
        <div class="card-header-row">
          <h2 class="card-title" style="margin:0;">Tarefas</h2>
          <select id="view-tarefas" class="view-selector" onchange="atualizarGraficoTarefas()">
            <option value="total">Visualizar: Por Total</option>
            <option value="prioridade">Visualizar: Por Prioridade</option>
          </select>
        </div>

        <div class="stat-group">
          <p>Total Geral: <span id="tarefas-total" class="stat-value">0</span></p>
          <div style="display: flex; gap: 15px; font-size: 0.9em; margin-bottom: 10px;">
             <span style="color:#00ff00">Concluídas: <span id="tarefas-concluidas">0</span></span>
             <span style="color:#ff0000">Pendentes: <span id="tarefas-pendentes">0</span></span>
          </div>
        </div>
        
        <h3 class="card-subtitle">Prioridades (Pendentes)</h3>
        <div class="stat-group priority-group">
          <p>Alta: <span id="tarefas-prio-alta" class="stat-value p-alta" onclick="abrirModal('tarefas', 'Alta')">0</span></p>
          <p>Média: <span id="tarefas-prio-media" class="stat-value p-media" onclick="abrirModal('tarefas', 'Media')">0</span></p>
          <p>Baixa: <span id="tarefas-prio-baixa" class="stat-value p-baixa" onclick="abrirModal('tarefas', 'Baixa')">0</span></p>
        </div>

        <div class="chart-wrapper">
          <canvas id="chartTarefas"></canvas>
        </div>
      </div>

      <div class="stat-card">
        <div class="card-header-row">
          <h2 class="card-title" style="margin:0;">Projetos</h2>
          <select id="view-projetos" class="view-selector" onchange="atualizarGraficoProjetos()">
            <option value="total">Visualizar: Por Total</option>
            <option value="prioridade">Visualizar: Por Prioridade</option>
          </select>
        </div>

        <div class="stat-group">
          <p>Total Geral: <span id="projetos-total" class="stat-value">0</span></p>
          <div style="display: flex; gap: 15px; font-size: 0.9em; margin-bottom: 10px;">
             <span style="color:#00ff00">Concluídos: <span id="projetos-concluidos">0</span></span>
             <span style="color:#ff0000">Pendentes: <span id="projetos-pendentes">0</span></span>
          </div>
        </div>

        <h3 class="card-subtitle">Prioridades (Pendentes)</h3>
        <div class="stat-group priority-group">
          <p>Alta: <span id="projetos-prio-alta" class="stat-value p-alta" onclick="abrirModal('projetos', 'Alta')">0</span></p>
          <p>Média: <span id="projetos-prio-media" class="stat-value p-media" onclick="abrirModal('projetos', 'Media')">0</span></p>
          <p>Baixa: <span id="projetos-prio-baixa" class="stat-value p-baixa" onclick="abrirModal('projetos', 'Baixa')">0</span></p>
        </div>
        
        <div class="chart-wrapper">
          <canvas id="chartProjetos"></canvas>
        </div>
      </div>

      <div class="stat-card">
        <h2 class="card-title">Top Projetos (Pendentes)</h2>
        <div class="stat-group" id="tarefas-por-projeto-lista">
          <p class="console-text">C:\\> Calculando...</p>
        </div>
      </div>

      <div class="stat-card full-width-card">
        <h2 class="card-title">Filtro Temporal (Protocolo Search)</h2>
        
        <div class="form-hacker search-grid-layout">
          <div class="form-group" style="margin:0">
            <label class="console-label">>> Data Início:</label>
            <input type="date" id="busca-inicio" class="form-input" style="width: 100%;">
          </div>
          
          <div class="form-group" style="margin:0">
            <label class="console-label">>> Data Fim:</label>
            <input type="date" id="busca-fim" class="form-input" style="width: 100%;">
          </div>

          <div class="search-buttons-group">
            <button type="button" class="btn-hacker search-btn" onclick="buscarPorData('tarefas')">[ Buscar Tarefas ]</button>
            <button type="button" class="btn-hacker search-btn" onclick="buscarPorData('projetos')" style="border-color: #00ffff; color: #00ffff;">[ Buscar Projetos ]</button>
          </div>
        </div>

        <div id="resultado-busca-container" style="margin-top: 15px; max-height: 200px; overflow-y: auto; border-top: 1px dashed #333; padding-top: 10px; display: none;">
          <p class="console-text" style="color: #ffff00;">>> Resultados da busca:</p>
          <ul id="lista-resultados" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
      </div>

    </div>
  </div>
</div>

<%- include('partials/modal-detalhes') %>
<script src="/js/dashboard-logic.js"></script>