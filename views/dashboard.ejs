<%- contentFor('body') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<link rel="stylesheet" href="/css/dashboard.css">

<div class="container-lista">
  <div class="terminal-header">
    <div class="terminal-title">system@dashboard:~</div>
    <div class="terminal-controls">
      <div class="control-btn minimize"></div>
      <div class="control-btn maximize"></div>
      <div class="control-btn close"></div>
    </div>
  </div>

  <div class="terminal-body dashboard-container">
    <h1 class="glitch" data-text="[ Dashboard v3.1 ]">[ Dashboard v3.1 ]</h1>
    <p class="console-text" id="dashboard-status">C:\\> Carregando_modulos...</p>

    <div class="dashboard-grid">
      
      <div class="stat-card">
        <div class="card-header-row">
          <h2 class="card-title" style="margin:0;">Tarefas</h2>
          <select id="view-tarefas" class="view-selector" onchange="atualizarGraficoTarefas()">
            <option value="total">Status (Total)</option>
            <option value="prioridade">Prioridade</option>
          </select>
        </div>

        <div class="stat-group">
          <p>Total Geral: <span id="tarefas-total" class="stat-value">0</span></p>
          <div style="display: flex; gap: 15px; font-size: 0.9em; margin-bottom: 10px;">
             <span style="color:#00ff00">Concluídas: <span id="tarefas-concluidas">0</span></span>
             <span style="color:#ff0000">Pendentes: <span id="tarefas-pendentes">0</span></span>
          </div>
        </div>
        
        <h3 class="card-subtitle">Prioridades (Pendentes)</h3>
        <div class="stat-group priority-group">
          <p>Alta: <span id="tarefas-prio-alta" class="stat-value p-alta" onclick="abrirModal('tarefas', 'Alta')">0</span></p>
          <p>Média: <span id="tarefas-prio-media" class="stat-value p-media" onclick="abrirModal('tarefas', 'Media')">0</span></p>
          <p>Baixa: <span id="tarefas-prio-baixa" class="stat-value p-baixa" onclick="abrirModal('tarefas', 'Baixa')">0</span></p>
        </div>

        <div class="chart-wrapper">
          <canvas id="chartTarefas"></canvas>
        </div>
      </div>

      <div class="stat-card">
        <div class="card-header-row">
          <h2 class="card-title" style="margin:0;">Projetos</h2>
          <select id="view-projetos" class="view-selector" onchange="atualizarGraficoProjetos()">
            <option value="total">Status (Total)</option>
            <option value="prioridade">Prioridade</option>
          </select>
        </div>

        <div class="stat-group">
          <p>Total Geral: <span id="projetos-total" class="stat-value">0</span></p>
          <div style="display: flex; gap: 15px; font-size: 0.9em; margin-bottom: 10px;">
             <span style="color:#00ff00">Concluídos: <span id="projetos-concluidos">0</span></span>
             <span style="color:#ff0000">Pendentes: <span id="projetos-pendentes">0</span></span>
          </div>
        </div>

        <h3 class="card-subtitle">Prioridades (Pendentes)</h3>
        <div class="stat-group priority-group">
          <p>Alta: <span id="projetos-prio-alta" class="stat-value p-alta" onclick="abrirModal('projetos', 'Alta')">0</span></p>
          <p>Média: <span id="projetos-prio-media" class="stat-value p-media" onclick="abrirModal('projetos', 'Media')">0</span></p>
          <p>Baixa: <span id="projetos-prio-baixa" class="stat-value p-baixa" onclick="abrirModal('projetos', 'Baixa')">0</span></p>
        </div>
        
        <div class="chart-wrapper">
          <canvas id="chartProjetos"></canvas>
        </div>
      </div>

      <div class="stat-card">
        <h2 class="card-title">Top Projetos (Pendentes)</h2>
        <div class="stat-group" id="tarefas-por-projeto-lista">
          <p class="console-text">C:\\> Calculando...</p>
        </div>
      </div>

      <div class="stat-card full-width-card">
        <h2 class="card-title">Filtro Temporal (Protocolo Search)</h2>
        
        <div class="form-hacker search-grid-layout">
          <div class="form-group">
            <label class="console-label">>> Data Início:</label>
            <input type="date" id="busca-inicio" class="form-input" style="width: 100%;">
          </div>
          
          <div class="form-group">
            <label class="console-label">>> Data Fim:</label>
            <input type="date" id="busca-fim" class="form-input" style="width: 100%;">
          </div>

          <div class="search-buttons-group">
            <button type="button" class="btn-hacker search-btn" onclick="buscarPorData('tarefas')">[ Tarefas ]</button>
            <button type="button" class="btn-hacker search-btn" onclick="buscarPorData('projetos')" style="border-color: #00ffff; color: #00ffff;">[ Projetos ]</button>
          </div>
        </div>

        <div id="resultado-busca-container" style="margin-top: 15px; max-height: 200px; overflow-y: auto; border-top: 1px dashed #333; padding-top: 10px; display: none;">
          <p class="console-text" style="color: #ffff00;">>> Resultados encontrados:</p>
          <ul id="lista-resultados" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
      </div>

    </div>
  </div>
</div>

<%- include('partials/modal-detalhes') %>
<script src="/js/dashboard-logic.js"></script>