<%- contentFor('body') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>

<style>
  .stat-value.p-alta, .stat-value.p-media, .stat-value.p-baixa {
    cursor: pointer; text-decoration: underline; transition: text-shadow 0.3s ease;
  }
  .stat-value.p-alta:hover { text-shadow: 0 0 10px #ff0000; }
  .stat-value.p-media:hover { text-shadow: 0 0 10px #ffff00; }
  .stat-value.p-baixa:hover { text-shadow: 0 0 10px #00ff00; }
  
  /* Garante que os gráficos tenham altura */
  .chart-wrapper {
    position: relative;
    height: 200px;
    width: 100%;
    margin-top: 15px;
  }

  /* Grid responsivo */
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  /* Grid de busca ocupando linha inteira se possível */
  .full-width-card {
    grid-column: 1 / -1;
  }
</style>

<div class="container-lista">
  <div class="terminal-header">
    <div class="terminal-title">system@dashboard:~</div>
    <div class="terminal-controls">
      <div class="control-btn minimize"></div>
      <div class="control-btn maximize"></div>
      <div class="control-btn close"></div>
    </div>
  </div>

  <div class="terminal-body dashboard-container">
    <h1 class="glitch" data-text="[ Dashboard v2.0 ]">[ Dashboard v2.0 ]</h1>
    <p class="console-text" id="dashboard-status">C:\\> Inicializando_modulos...</p>

    <div class="dashboard-grid">
      
      <div class="stat-card">
        <h2 class="card-title">Tarefas</h2>
        <div class="stat-group">
          <p>Total: <span id="tarefas-total" class="stat-value">0</span></p>
          <p>Concluídas: <span id="tarefas-concluidas" class="stat-value" style="color: #00ff00;">0</span></p>
          <p>Pendentes: <span id="tarefas-pendentes" class="stat-value" style="color: #ff0000;">0</span></p>
        </div>
        <h3 class="card-subtitle">Prioridades (Pendentes)</h3>
        <div class="stat-group priority-group">
          <p>Alta: <span id="tarefas-prio-alta" class="stat-value p-alta" onclick="abrirModal('tarefas', 'Alta')">0</span></p>
          <p>Média: <span id="tarefas-prio-media" class="stat-value p-media" onclick="abrirModal('tarefas', 'Media')">0</span></p>
          <p>Baixa: <span id="tarefas-prio-baixa" class="stat-value p-baixa" onclick="abrirModal('tarefas', 'Baixa')">0</span></p>
        </div>
        <div class="chart-wrapper">
          <canvas id="chartTarefas"></canvas>
        </div>
      </div>

      <div class="stat-card">
        <h2 class="card-title">Projetos</h2>
        <div class="stat-group">
          <p>Total: <span id="projetos-total" class="stat-value">0</span></p>
          <p>Concluídos: <span id="projetos-concluidos" class="stat-value" style="color: #00ff00;">0</span></p>
          <p>Pendentes: <span id="projetos-pendentes" class="stat-value" style="color: #ff0000;">0</span></p>
        </div>
        <h3 class="card-subtitle">Prioridades (Pendentes)</h3>
        <div class="stat-group priority-group">
          <p>Alta: <span id="projetos-prio-alta" class="stat-value p-alta" onclick="abrirModal('projetos', 'Alta')">0</span></p>
          <p>Média: <span id="projetos-prio-media" class="stat-value p-media" onclick="abrirModal('projetos', 'Media')">0</span></p>
          <p>Baixa: <span id="projetos-prio-baixa" class="stat-value p-baixa" onclick="abrirModal('projetos', 'Baixa')">0</span></p>
        </div>
        <div class="chart-wrapper">
          <canvas id="chartProjetos"></canvas>
        </div>
      </div>

      <div class="stat-card">
        <h2 class="card-title">Top Projetos (Pendentes)</h2>
        <div class="stat-group" id="tarefas-por-projeto-lista">
          <p class="console-text">C:\\> Calculando...</p>
        </div>
      </div>

      <div class="stat-card full-width-card">
        <h2 class="card-title">Filtro Temporal (Protocolo Search)</h2>
        
        <div class="form-hacker" style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
          <div class="form-group" style="flex: 1; min-width: 200px;">
            <label class="console-label">>> Data Início:</label>
            <input type="date" id="busca-inicio" class="form-input" style="width: 100%;">
          </div>
          
          <div class="form-group" style="flex: 1; min-width: 200px;">
            <label class="console-label">>> Data Fim:</label>
            <input type="date" id="busca-fim" class="form-input" style="width: 100%;">
          </div>

          <div class="form-group" style="display: flex; gap: 10px;">
            <button type="button" class="btn-hacker" onclick="buscarPorData('tarefas')">[ Buscar Tarefas ]</button>
            <button type="button" class="btn-hacker" onclick="buscarPorData('projetos')" style="border-color: #00ffff; color: #00ffff;">[ Buscar Projetos ]</button>
          </div>
        </div>

        <div id="resultado-busca-container" style="margin-top: 15px; max-height: 200px; overflow-y: auto; border-top: 1px dashed #333; padding-top: 10px; display: none;">
          <p class="console-text" style="color: #ffff00;">>> Resultados da busca:</p>
          <ul id="lista-resultados" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
      </div>

    </div>
  </div>
</div>

<%- include('partials/modal-detalhes') %>

<script src="/js/dashboard-logic.js"></script>