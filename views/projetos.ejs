<h2>Meus Projetos</h2>
<p>Gerencie seus projetos aqui.</p>

<form id="form-criar-projeto">
  <div class="form-group">
    <label for="nome">Nome do Projeto:</label>
    <input type="text" id="nome" name="nome" required placeholder="Ex: Refatorar API...">
  </div>
  <div class="form-group">
    <label for="descricao">Descrição (Opcional):</label>
    <textarea id="descricao" name="descricao" placeholder="Ex: Aplicar novo tema..."></textarea>
  </div>
  <button type="submit" class="btn">Criar Projeto</button>
</form>

<h2 style="margin-top: 2rem;">Projetos Atuais</h2>

<div id="lista-projetos">
  <% if (projetos.length > 0) { %>
    <% projetos.forEach(projeto => { %>
      <div class="list-item" id="projeto-<%= projeto._id %>">
        <div class="item-content">
          <h3><%= projeto.nome %></h3>
          <p><%= projeto.descricao || 'Sem descrição' %> (Status: <%= projeto.status %>)</p>
        </div>
        <div class="item-actions">
          <button class="btn btn-delete" onclick="removerProjeto('<%= projeto._id %>')">Remover</button>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <p id="sem-projetos">Nenhum projeto encontrado.</p>
  <% } %>
</div>

<script>
  // Script para lidar com a criação de projetos via API
  document.getElementById('form-criar-projeto').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const nome = document.getElementById('nome').value;
    const descricao = document.getElementById('descricao').value;

    try {
      const response = await fetch('/api/projetos', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ nome, descricao }),
      });

      if (!response.ok) {
        const err = await response.json();
        throw new Error(err.message || 'Falha ao criar projeto');
      }

      // Recarrega a página para mostrar o novo projeto
      location.reload();

    } catch (error) {
      console.error('Erro:', error);
      alert(error.message);
    }
  });

  // Script para remover projeto via API
  async function removerProjeto(id) {
    if (!confirm('Tem certeza que deseja remover este projeto?')) {
      return;
    }

    try {
      const response = await fetch(`/api/projetos/${id}`, {
        method: 'DELETE',
      });

      if (!response.ok) {
        const err = await response.json();
        throw new Error(err.message || 'Falha ao remover projeto');
      }

      // Remove o item da UI
      const itemElement = document.getElementById(`projeto-${id}`);
      if (itemElement) {
        itemElement.remove();
      }
      
      // Verifica se a lista está vazia
      const lista = document.getElementById('lista-projetos');
      if (lista.getElementsByClassName('list-item').length === 0) {
        const msg = document.getElementById('sem-projetos');
        if (msg) msg.style.display = 'block';
      }

    } catch (error) {
      console.error('Erro:', error);
      alert(error.message);
    }
  }
</script>